---
import "../styles/global.css";
export interface Props {
  title: string;
}

const { title } = Astro.props;

import { Image } from "astro:assets";
import rings from "../assets/vectors/rings.svg";
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body>
    <!--<header class="header">
      <div class="vector-1">
        <Image src={rings} alt="rings" class="rings" />
      </div>
    </header>-->
    <slot />

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const rings = document.querySelector(".rings");
        const soundIndicator = document.getElementById("soundIndicator");
        let audioEnabled = false;

        // Crear el objeto de audio una sola vez
        const hoverSound = new Audio("/sounds/SFX_1.mp3");
        hoverSound.volume = 0.3;

        // FunciÃ³n para habilitar el audio
        const enableAudio = () => {
          audioEnabled = true;
          if (soundIndicator) {
            soundIndicator.innerHTML = "<span>ðŸ”Š</span> SONIDO ACTIVADO";
            soundIndicator.style.opacity = "0.5";
            setTimeout(() => {
              soundIndicator.style.display = "none";
            }, 2000);
          }

          // Intentar reproducir un sonido de prueba (silenciado)
          hoverSound.volume = 0;
          hoverSound
            .play()
            .then(() => {
              hoverSound.pause();
              hoverSound.currentTime = 0;
              hoverSound.volume = 0.3;
            })
            .catch((e) => console.log("Audio listo"));

          // Remover listeners despuÃ©s de activar
          document.removeEventListener("click", enableAudio);
          document.removeEventListener("touchstart", enableAudio);
          document.removeEventListener("keydown", enableAudio);
        };

        // Esperar interacciÃ³n del usuario
        document.addEventListener("click", enableAudio);
        document.addEventListener("touchstart", enableAudio);
        document.addEventListener("keydown", enableAudio);

        // Manejar el hover
        if (rings) {
          rings.addEventListener("mouseenter", () => {
            if (audioEnabled) {
              hoverSound.currentTime = 0;
              hoverSound.play().catch((error) => {
                console.log("Error al reproducir:", error);
              });
            } else {
              // Feedback visual si el audio no estÃ¡ activado
              if (soundIndicator) {
                soundIndicator.style.backgroundColor = "#ff4444";
                soundIndicator.style.opacity = "1";
                setTimeout(() => {
                  soundIndicator.style.backgroundColor = "#333";
                }, 300);
              }
            }
          });
        }
      });
    </script>
  </body>
</html>
